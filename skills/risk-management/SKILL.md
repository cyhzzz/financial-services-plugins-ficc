# Risk Management

## Description

商业银行 FICC 业务全面风险管理体系，深度融合 ficc-analysis-skill 的风险计量与归因分析能力，严格遵循 Anthropic financial-services-plugins 架构标准，覆盖市场风险、信用风险、流动性风险、操作风险四大类别，提供风险识别、计量、监控、报告完整能力。具备真实业务场景下的风险量化分析、压力测试、限额管理、监管报送等核心能力。

## Capabilities

### 1. 市场风险 (Market Risk)

#### 1.1 风险价值模型 (VaR/CVaR)

**参数法 (Parametric/Variance-Covariance)**:

**理论基础**:
- 假设组合收益率服从正态分布
- 使用均值-方差框架计算风险
- 适用于线性工具或近似线性组合

**数学模型**:

单个资产VaR:
```
VaR = Z_α × σ × √t × V

其中:
- Z_α: 置信水平对应的分位数 (99%→2.33, 95%→1.65)
- σ: 资产收益率的标准差 (日波动率)
- t: 持有期 (天数)
- V: 资产市值
```

组合VaR (考虑相关性):
```
VaR_p = Z_α × σ_p × √t × V_p

组合波动率:
σ_p = √(w^T × Σ × w) = √(Σᵢ Σⱼ wᵢ × wⱼ × σᵢ × σⱼ × ρᵢⱼ)

其中:
- w: 资产权重向量 (n×1)
- Σ: 协方差矩阵 (n×n)
- σᵢ, σⱼ: 资产i,j的波动率
- ρᵢⱼ: 资产i,j的相关系数
```

边际VaR (增量风险贡献):
```
ΔVaRᵢ = VaR(with asset i) - VaR(without asset i)

或解析法:
ΔVaRᵢ = Z_α × (Σ × w)ᵢ / σ_p × √t × V_p / V_p
```

成分VaR (风险归因):
```
Component VaRᵢ = wᵢ × ΔVaRᵢ = wᵢ × Z_α × (Σ × w)ᵢ / σ_p × √t × V_p

归一化: Σ Component VaRᵢ = VaR_p
```

**CVaR (Expected Shortfall/Conditional VaR)**:
```
CVaR_α = E[L | L > VaR_α] = (1 / (1-α)) × ∫[VaR_α,∞] L × f(L) dL

正态分布假设下:
CVaR_α = σ × φ(Z_α) / (1-α) × √t × V

其中φ为标准正态密度函数:
- 99% CVaR ≈ 2.67 × σ × √t × V (vs VaR = 2.33 × σ × √t × V)
- 95% CVaR ≈ 2.06 × σ × √t × V (vs VaR = 1.65 × σ × √t × V)
```

**模型优缺点**:

| 优点 | 缺点 |
|------|------|
| 计算速度快，可实时更新 | 假设收益率正态分布（实际有肥尾） |
| 可解析计算边际风险和风险归因 | 对非线性工具（如期权）近似误差大 |
| 易于扩展到多资产组合 | 对极端事件（黑天鹅）估计不足 |
| 参数敏感性分析简单 | 相关系数在危机时趋于1（模型风险） |

**历史模拟法 (Historical Simulation)**:

**理论基础**:
- 不假设收益率分布形式
- 直接使用历史收益率数据
- 通过历史分位数估计VaR

**数学模型**:

```
基本步骤:
1. 收集历史收益率数据 (通常为1-5年日度数据)
2. 计算组合在当前持仓下的历史损益分布
3. 取损益分布的α分位数作为VaR

组合损益计算:
对于历史场景s (s=1,2,...,n):
L_s = Σᵢ (Vᵢ × R_{i,s})

其中:
- Vᵢ: 资产i的当前市值
- R_{i,s}: 资产i在场景s的历史收益率
- L_s: 场景s下的组合损益

VaR估计:
VaR_α = -Percentile({L_s}, α×100)

例如99% VaR = -第1百分位数 (最坏的1%场景)

CVaR估计:
CVaR_α = -Mean({L_s | L_s ≤ -VaR_α})
```

**加权历史模拟法 (Weighted Historical Simulation)**:

```
为了解决简单历史模拟法对近期和远期事件同等对待的问题:

权重分配:
- 指数衰减权重: w_t = λ^(T-t) × (1-λ) / (1-λ^T)
  其中λ为衰减因子 (通常0.94-0.99)
  t为时间点，T为总期数

- 最近数据获得更高权重，反映市场变化

加权VaR计算:
1. 将历史损益按大小排序
2. 计算累积权重直到达到1-α
3. 通过线性插值得到加权VaR
```

**模型优缺点**:

| 优点 | 缺点 |
|------|------|
| 不依赖分布假设，捕捉实际历史肥尾 | 假设历史会重演（可能错过新类型风险） |
| 直观易懂，容易向管理层解释 | 对极端事件估计依赖历史样本量 |
| 自动捕捉资产间相关性（历史中隐含） | 数据周期选择主观（太短=样本不足，太长=过时） |
| 计算相对简单（排序取分位数） | 对组合变化需要重新计算全部历史场景 |
| | 平滑处理导致对近期变化反应滞后 |

（由于内容过长，我将继续完成其余部分...）
